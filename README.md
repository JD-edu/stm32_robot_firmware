# STM32F407 기반 자율주행 로봇 펌웨어

이 프로젝트는 STM32F407 마이크로컨트롤러를 기반으로 자율주행 로봇을 구축하기 위한 펌웨어를 제공합니다. 주요 기능으로는 IMU 센서 통합, 모터 제어, 센서 데이터 융합 및 상위 컴퓨터와의 통신 등이 포함됩니다.

## 주요 기능

### 1. MPU6050 IMU 센서 통합

MPU6050 IMU 센서를 STM32F407에 연결하여 가속도계 및 자이로스코프 데이터를 수집합니다. 이를 위해 다음과 같은 작업을 수행합니다:

- **MPU6050의 ID 읽기**: 센서의 올바른 작동을 확인하기 위해 장치 ID를 읽습니다.
- **가속도계 설정**: 원하는 측정 범위와 해상도로 가속도계를 구성합니다.
- **자이로스코프 설정**: 자이로스코프의 측정 범위와 해상도를 설정합니다.

### 2. 시리얼 통신을 통한 데이터 전송

IMU 센서로부터 수집한 데이터를 상위 컴퓨터(예: 라즈베리 파이)로 전송하기 위해 시리얼 포트를 사용합니다. 이를 통해 실시간으로 센서 데이터를 모니터링하고 처리할 수 있습니다.

### 3. 타이머를 활용한 주기적 데이터 수집

타이머를 활용하여 IMU 센서 데이터를 주기적으로 읽고, 시리얼 통신을 통해 상위 컴퓨터로 전송합니다. 이를 통해 안정적인 데이터 수집 주기를 유지합니다.

### 4. 센서 데이터 융합

수집한 IMU 데이터를 보상 필터 및 칼만 필터를 사용하여 센서 융합을 수행합니다. 이를 통해 pitch, roll, yaw와 같은 자세 정보를 정확하게 계산합니다.

### 5. 모터 제어 및 엔코더 피드백

상위 컴퓨터에서 전송하는 명령을 기반으로 모터를 제어합니다. 모터의 엔코더 값은 TIM4의 엔코더 모드를 활용하여 획득하며, 이를 통해 정확한 모터 위치 및 속도 제어가 가능합니다.

## 사용된 STM32 주변 장치

- **시리얼(UART)**: 상위 컴퓨터와의 통신에 사용됩니다.
- **타이머(Timer)**: 주기적인 센서 데이터 수집 및 모터 제어에 활용됩니다.
- **인터럽트 콜백(Interrupt Callback)**: 실시간 이벤트 처리에 사용됩니다.
- **GPIO**: 일반적인 입출력 제어에 사용됩니다.
- **I2C**: MPU6050 센서와의 통신에 사용됩니다.

## ROS2 기반 자율주행 로봇 개발

이 펌웨어 예제를 활용하여 ROS2 기반의 자율주행 로봇 펌웨어 개발을 학습하고 구현할 수 있습니다. 이를 통해 로봇의 센서 데이터 처리, 모터 제어 및 상위 레벨의 자율주행 알고리즘과의 통합을 경험할 수 있습니다.

자세한 내용은 [doc 폴더](./doc)에 있는 마크다운 문서를 참고하시기 바랍니다. 
